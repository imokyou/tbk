<?php /* ç¨‹åºä¾ ç‰ˆæƒæ‰€æœ‰ æŠ€æœ¯è®ºå›æ”¯æŒ: bbs.chengxuxia.com QQ: 573907419 æ­£ç‰ˆæˆæƒé˜²æ­¢å‡ºç°æ¼æ´åé—¨
-- enphp : https://git.oschina.net/mz/mzphp2
 */   namespace app\admin\controller;error_reporting(E_ALL^E_NOTICE);define('ñ', 'û');öÃ´²ã®¢·õ˜éäïºØ¤™€å‰… ¼¿ıÂƒÁ¹Æõë«¥âœ§Í—Î¼§¨àÁÅá¨ÏæÈŒ§ÇÎ«‰‰ñ€õ¥…Á­ÎÂÄşìÆà;$GLOBALS[ñ] = explode('|.|@|?', '¤Ø·|.|@|?è|.|@|?|"|?|8|.|@|?ORG.PclZip|"|?|8chengxuxia.cxxia_release|"|?|8chengxuxia.cxxia_version|"|?|8release|"|?|8this_version|"|?|8this_release|"|?|8last_release|"|?|8version_list|"|?|8curl|"|?|8do|"|?|8upgrade|"|?|8type|"|?|8base|"|?|8domain|"|?|8HTTP_HOST|"|?|8latestversion|"|?|8updatelist|"|?|8---ä¸æœåŠ¡å™¨ä¸è¿é€š|"|?|8---éªŒè¯æ–‡ä»¶å†™å…¥å¤±è´¥|"|?|8data|"|?|8ç¼“å­˜å†™å…¥å¤±è´¥|"|?|8error|"|?|8data.php|"|?|8è¯·é…ç½®æ”¯æŒcurl|"|?|8version|"|?|8å¼€å§‹å¤‡ä»½é‡è¦ç¨‹åºæ–‡ä»¶...|"|?|8info|"|?|8backup/site/|"|?|8.zip|"|?|8application,data,static|"|?|8|"|?|8æˆåŠŸå¤‡ä»½app,staticæ–‡ä»¶|"|?|8success|"|?|8å¤‡ä»½è·¯å¾„:data/backup/site/|"|?|8file|"|?|8back_file_list|"|?|8/(.*)\\.zip/|"|?|8å¼€å§‹è¿˜åŸ|"|?|8./|"|?|8å¤‡ä»½è¿˜åŸå¤±è´¥|"|?|8å¤‡ä»½è¿˜åŸæˆåŠŸ|"|?|8extra/chengxuxia.php|"|?|8ç‰ˆæœ¬å·ï¼š|"|?|8 å‡çº§å¤±è´¥|"|?|8 å‡çº§æˆåŠŸ|"|?|8?version|"|?|8å¼€å§‹è·å–è¿œç¨‹å‡çº§åŒ…...|"|?|8download|"|?|8æœªè·å–åˆ°å‡çº§åŒ…çš„|"|?|8/|"|?|8è·å–å‡çº§åŒ…å¤±è´¥ï¼Œè¯·é‡è¯•ï¼|"|?|8md5|"|?|8filemd5|"|?|8è·å–å‡çº§åŒ…æˆåŠŸ|"|?|8è·å–å‡çº§åŒ…é”™è¯¯|"|?|8è·å–å‡çº§åŒ…å¤±è´¥|"|?|8è¯»å–ç¼“å­˜æ–‡ä»¶å¤±è´¥|"|?|8ç¼“å­˜æ–‡ä»¶ä¸å­˜åœ¨|"|?|8å¼€å§‹å‡çº§ç¨‹åº...|"|?|8/uploads/|"|?|8/md5.txt|"|?|8æ›´æ–°éªŒè¯æ–‡ä»¶ä¸å­˜åœ¨|"|?|8æ›´æ–°éªŒè¯æ–‡ä»¶ä¸æ­£ç¡®|"|?|8å¼€å§‹æ›´æ–°æ–‡ä»¶|"|?|8path|"|?|8å‡çº§å¤±è´¥|"|?|8<font style=\\"font-size:14px\\">|"|?|8å‡çº§å¤±è´¥</font>|"|?|8æç¤ºï¼šè¯·å°†å‡çº§å¤±è´¥çš„æ–‡ä»¶ç›®å½•æƒé™è®¾ç½®æˆä¸ºï¼š777|"|?|8.sql|"|?|8å¼€å§‹å‡çº§æ•°æ®åº“...|"|?|8
|"|?|8
|"|?|8;
|"|?|8è¯·å°† ./data ç›®å½•æƒé™è®¾ç½®æˆä¸º777|"|?|8æ•°æ®å‡çº§åº“å®Œæ¯•|"|?|8cxxia_log|"|?|8HTTP_USER_AGENT|"|?|8post|"|?|8folder|"|?|8Y-m-d|"|?|8authTime|"|?|8HTTP_HOST|"|?|8aHR0cDovL2xpY2Vuc2UuY2hlbmd4dXhpYS5uZXQvRG9tYWluVmVyaWZ5P3R5cGU9YmFzZSZkb21haW49|"|?|8JnNpZ249|"|?|8code|"|?|8Content-Type:text/html; charset=utf-8|"|?|8msg');ÂÖİª éÒç¹ıñÂğñ¹;error_reporting(E_ALL^E_NOTICE);define($GLOBALS{ñ}[0],$GLOBALS{ñ}{0x001});éÌÙ†Úß©ö¢…Şë´„íÑ¡ëİÜä˜Ò¦Ô÷‹ÍÒìÈ¼¹¢Â•ƒì¥ñë‘¦ğ€ø’ë×îĞğÂöÅºƒ“ïÜÊª€¿ƒúÌ¨ì¹º”ªº½§ä¬÷Õïïœ«ó¯¹ã„“Î‘›ºûÕô€°½×„êĞÙÚÁö‡µ§À™´Å¨ÂØöÓç“äèƒõé´”¨Œ™“İóîŸêõÔ’·îÆü—‰Õİ¾¢ë£‹ï™õ;$_GET[¤Ø·]=explode($GLOBALS{ñ}[0x0002],$GLOBALS{ñ}{0x00003});±Ç²»¢¯¦˜…¸Ğó€Í‹Š¤šçâ¼Ô‡ÈÄ ¾éÏİœ˜¬Ó²ÛúËà´œÕ´éà;\think\Loader::import($_GET{¤Ø·}[0],EXTEND_PATH);use think\Db;use think\Config;use app\common\controller\Admin;class Upgrade extends Admin{private $chengxuxiaUrl="http://upgrade.chengxuxia.net/";private $upgradeUrl="http://upgrade.chengxuxia.net/UpgradePostRequest?dotype=upgrade";private $thisRelease;private $thisVersion;private $latestRelease="";private $latestversion="";public function _initialize(){$Â«=&$_GET{¤Ø·};‚°óÖâÏÒ¯±‡Ë‡¼¶èûÅå£;parent::_initialize();$this->_license();…÷’á’ºõ¤Î˜ë;$this->thisRelease=config($Â«{0x001});$this->thisVersion=config($Â«[0x0002]);ñµé—¢;¶…Õ¹¶ÉššâÉÌê–Ó§Í½¤“£ÇËÂèüåÊÉÊØ€Ğ®¹‡÷Ê¡“®ëß™‚³ÁÏñå;}public function index(){$•®¯Ø=&$_GET{¤Ø·};$¾â=$this->checkVersion();÷Úé²ââü„;if(!empty($¾â)&& is_array($¾â)){$«ğÕÅó=key($¾â);$ˆ=$¾â[$«ğÕÅó][$•®¯Ø{0x00003}];$this->assign($•®¯Ø[0x000004],$ˆ);}$this->assign($•®¯Ø{0x05},$this->thisRelease);$this->assign($•®¯Ø[0x006],$this->latestversion);¨‘Øé¶†©™ı³Õõ¿©ğ¢¦õ˜Òæî™Úø¢ ô‘È‡¯¡ğæ¨š§ÍÖÜ—ÇÍ¹îÄÒÁ«ÂÛ‡»ı§°ğ¸¿“ª¦¼Å§ã“ş‚ğ–Ê¿Ğ¹„¤ú°æ;ïºãÜ‡îÏ¼ÙæÌû‡ÕıÓĞ­ˆ×±ÁÖÈŒ·ò‘ÁäşüÈÜ„¸¬Á’”œ;ÕàÓäÑŒ¥å¶Ì¢ûô†;$this->assign($•®¯Ø{0x0007},$¾â);µ»øì»ã¶È›ªÙ«ì¿«é;Š;return $this->fetch();Å€‰õæà®‰¶İœáéÁÇ é„ğ­÷ú¯ƒÏğŞİ¶Şç­ÆÈÜÏ€;}private function checkVersion(){$­Î˜Ş=&$_GET{¤Ø·};if(extension_loaded($­Î˜Ş[0x00008])){$íÖ=$this->upgradeUrl;$ò…êí´=[$­Î˜Ş{0x000009}=>$­Î˜Ş[0x0a],$­Î˜Ş{0x00b}=>$­Î˜Ş[0x000c],$­Î˜Ş{0x00003}=>$this->thisRelease,$­Î˜Ş{0x0000d}=>$_SERVER[$­Î˜Ş[0x00000e]]];$½¦Íœİ=$this->_curl($íÖ,$ò…êí´);$„‹=[];$„‹=(array)json_decode($½¦Íœİ,!0);if(!$„‹|| !is_array($„‹)){return !0x001;}$this->latestversion=$„‹[$­Î˜Ş{0x0f}];if($this->thisRelease <$this->latestversion){$ÍçÄÍÔ=$„‹[$­Î˜Ş[0x0010]];krsort($ÍçÄÍÔ);foreach($ÍçÄÍÔ as $ê¤‹Ê»=>$¹½œ){if($this->thisRelease <trim($¹½œ[$­Î˜Ş{0x00003}])){$°¡[$ê¤‹Ê»]=$¹½œ;$Ÿ=\chengxuxia\File::fetch_md5_list($¹½œ,$this->chengxuxiaUrl);if($Ÿ==0x001){\chengxuxia\File::cxxia_log($¹½œ[$­Î˜Ş{0x00003}].$­Î˜Ş{0x00011},$¹½œ[$­Î˜Ş{0x00003}]);}if($Ÿ==0x0002){\chengxuxia\File::cxxia_log($¹½œ[$­Î˜Ş{0x00003}].$­Î˜Ş[0x000012],$¹½œ[$­Î˜Ş{0x00003}]);}}}$‡İıÕ=\chengxuxia\File::cxxia_cache($­Î˜Ş{0x0000013},$°¡,CXXIA_UPGRADE_PATH);şæ÷;·˜ÙŸ³ç;š¥¯†É»Ñ†‹Ã¸ôÀÑ•—Øò•¯íñ³íÙ«º©èÕ;if($‡İıÕ==!0x001){$this->showMsg($­Î˜Ş[0x014],$­Î˜Ş{0x0015});exit;}if(is_file(CXXIA_UPGRADE_PATH.$­Î˜Ş[0x00016])){$™Û™Ô=require_once(CXXIA_UPGRADE_PATH.$­Î˜Ş[0x00016]);}if(!empty($„‹)&& $this->latestversion >$this->thisRelease){return $™Û™Ô;}}}else{$this->error($­Î˜Ş{0x000017});¦ÄßíŠë±´¹ªä—”ìÏ¬Çîà°Ûæï¯êá—ÚÆ¾Ÿ¦¬ªÄ™¬õÎæ ´ıµ¡Íâé½Ãš™ª‹É–íàğ´Ÿ‘ÛÌ¼ æè;}}public function backup(){$ºâôó=&$_GET{¤Ø·};íÍŸáãÎĞÕƒ¾¯¯øÙ˜Î¨²«ÂˆÚâŞ•ÅÔ;$this->assign($ºâôó[0x0000018],$this->thisRelease);ÍîœÑöÙ•’óÀ½×‹ŸÉÀ¿Úœ—¼óÔ«Ğ–Ÿû¤»Îœ–ã®Š¥;echo $this->fetch($ºâôó[0x0a]);×èÇ™¨¢¶¶ºò«»ÈÖÕí¬Ò’è¡®€†İŠ¬©Ó©‚¼ñœå”ÒœÏÆÇŒŸšåÇ¸ °ÚÎ°á¬»Ö;íî¼½¿’ÀıÂï÷œ‰Æ;$this->showMsg($ºâôó{0x019},$ºâôó[0x001a]);‰ÄÍë£ã²÷ìÑƒ¼ŞÛªÎ˜è«ªî›†‹¥ÍÑàÀÚ¥ÆÉòùÂßËÅœ«¢Çù;if(!is_file(CXXIA_DATA_PATH.$ºâôó{0x0001b})){\chengxuxia\File::cxxia_mk_dir(CXXIA_DATA_PATH.$ºâôó{0x0001b});}$±Šæ=CXXIA_DATA_PATH.$ºâôó{0x0001b}.$this->thisRelease.$ºâôó[0x00001c];$˜Ö÷=new \PclZip($±Šæ);´ş¬¥»×î¯Ñ²ø¬È›ôÃÖ¦Í¾ƒå•;$˜Ö÷-> create($ºâôó{0x000001d},PCLZIP_OPT_ADD_PATH,$ºâôó[0x01e]);˜ğ­˜½½Ú•­Šæß;$this->showMsg($ºâôó{0x001f},$ºâôó[0x00020]);$this->showMsg($ºâôó{0x000021}.$this->thisRelease.$ºâôó[0x00001c],$ºâôó[0x00020]);}public function restore(){$ÆÎó»=&$_GET{¤Ø·};$âàŠ=input($ÆÎó»[0x0000018]);áÌ˜ú¾Å“Ü„Ğ¸™ıÂİ;‹º®Ã•úíŒ¯­Õ€½æ™Ù‡Ñ‘˜ÍşÁèµ£å™ÀğÔîµéê£õ›ĞÌ›³µèºˆúÈ¡Œ– ÍşÖğåğ²×Å¢¯°¦©‚òÅ‘¦;¤Ô¬àç÷Ä;$this->assign($ÆÎó»[0x0000018],$this->thisRelease);’¡ß;„õª¥ƒÀÆĞÀÂ§õşÔ˜Œ…§¼«Ñ¿Ÿ˜ĞÅ”Ë¨˜ÂÒ¾Å”†—Ô¤Ùû³Ğû‰èˆ‘Å¹â…ÙûÕŸ¢È©ä›çª¯îÁ…“œ‚Æ;$=\chengxuxia\File::cxxia_get_dirs(CXXIA_DATA_PATH.$ÆÎó»{0x0001b});ÌÑñÈ§’ØÊÚƒ¯öë;$„ë´ê=$[$ÆÎó»[0x0000022]];Õ¦úû­Üä¥¡¯¨ÌÁÊÚ¡…â;µ§­…ş´ãè€üµÒïıúƒ×ÅŞ;¼Šêñ©ÖêÉ Áğ¢¼ì;$this->assign($ÆÎó»{0x023},$„ë´ê);õ¼‚ŠÃèäåîÇ¦ôÆã€²Õ©;ÇĞü¢íª‘¨ÙÆĞ‡ÌĞ»±¹¼¯îŸíŠ£ÆĞ‚¢ÆØé—Õ…€®Úåşá²Ïä‰Ú”øê´çô×®ÆÙÑ³¼;if($âàŠ){echo $this->fetch();preg_match($ÆÎó»[0x0024],$âàŠ,$ó©‚);$this->showMsg($ÆÎó»{0x00025}.$âàŠ,$ÆÎó»[0x001a]);$Ë¿Òœ=CXXIA_DATA_PATH.$ÆÎó»{0x0001b}.$âàŠ;$¥“—¨=new \PclZip($Ë¿Òœ);$¡ì=$¥“—¨->extract(PCLZIP_OPT_PATH,$ÆÎó»[0x000026]);if($¡ì===!0x001){$this->showMsg($ÆÎó»{0x0000027},$ÆÎó»{0x0015});exit;}else{$this->showMsg($âàŠ.$ÆÎó»[0x028],$ÆÎó»[0x00020]);}$†Ò=\chengxuxia\File::cxxia_read_file(APP_PATH.$ÆÎó»{0x0029});$†Ò=str_replace($this->thisRelease,$ó©‚[0x001],$†Ò);\chengxuxia\File::cxxia_write_file(APP_PATH.$ÆÎó»{0x0029},$†Ò);•Ü;}else{return $this->fetch();}}public function autoUpgrade(){$³«Ñ=&$_GET{¤Ø·};ö„È·×ä’üø©¥¬Ê“ÈĞåÔ ßÖµ½×ığ„Ğæ£ÌŞ;$•–=$this->checkVersion();õ•Ò›ŸœÅª†Ôö×;óÒ¤¡·éî¿ı–Å»îÄ­ò•”–âó¿÷Š¿ò³½ç‡á‰¤™ó”;$´¤¶=key($•–);º° ­ÆµÄ©©„¢´Ä•èƒıïäˆ•şü©·²Îîıºá¸ê‚æ±¸«Ûâ°ı˜õ”ø’ğŞ›†Ş™°–Ë€…Éºæ‚¥éé×£•³†Æ±¼Å µ;«è”Íğ×¶Óí­éÀÈ‰İ´ã­Ä¹¥‘ÅÛÏ˜Û‰˜ˆò¬Õã…¸óº¢µƒ«“’à÷¿¥;ô˜ò;echo $this->fetch();È¤ƒ÷§©á‘†§´;foreach($•– as $í=>$«ª­Ëà){$İ=$«ª­Ëà[$³«Ñ[0x0000018]];è‹¿óå‰„Šû±¶ŞÂ¸äéíñØÔ„‚êä‰ÈÚ†¿Ä‘€¹ö‰½–º³Íšö†şàôñºÉ¾Ìú¤ÖÄşÜ…Äî…şå¼ç¥÷›ò’’ù’óî…®¹–ì‡’‘İÖ‘;æ¬ƒ¡Î¸¥úÌ·ÛÄ;$ÖªàÕ=$«ª­Ëà[$³«Ñ{0x00003}];$this->checkVersion();•Œ”‰Ÿ¦„²šó·É­Í·µßÉ”·ÛÏ“;àê¬äù¶¾íÆ¦šÊÈéƒíäĞ¦À–ŸÂüˆÈˆí—×Ï‚…´ü¼óêƒ›;$this->upgrade($ÖªàÕ);Œä…ú©™;$È=$ÖªàÕ;Úû²¥ªÜàà¦ô™‚Ä¬µ;—¹˜ÚÇ–ã‘ŸÑ¨÷¡«üÖ¨ºÊ”½å›ŒÊŒŞáƒ—ù¼°;ÌˆÛÑƒ†êˆÏ«‘Ê‡ı¬¹;if($í==$´¤¶){$È=$this->thisRelease;$Š=$this->thisVersion;}else{$È=$•–[$í+0x001][$³«Ñ{0x00003}];$Š=$•–[$í+0x001][$³«Ñ[0x0000018]];}$á°=\chengxuxia\File::cxxia_read_file(APP_PATH.$³«Ñ{0x0029});$á°=str_replace($È,$ÖªàÕ,$á°);—Ï©;¨è•Ê¨áÓ„´Ö‹ŸßÚËğ¦Ó€¤¹¥‹Ó‡»â‚î·;$á°=str_replace($Š,$İ,$á°);â‚ĞÂ ³Æ¸­ƒéƒ‰±¼ šÈàùõÌ×úáïË;€¯È…ã ‘„ëĞñ’¤ñ·¥«Ü±€ãìâåÜ›‘µè‡µ˜Ï»üğÌ‚ñ¹ÒäÌ÷×„„áÏ„Æ¼ç­™ƒ¾Î;$Å…†–Á=\chengxuxia\File::cxxia_write_file(APP_PATH.$³«Ñ{0x0029},$á°);if($Å…†–Á===!0x001){$this->showMsg($³«Ñ[0x0002a].$ÖªàÕ.$³«Ñ{0x00002b},$³«Ñ{0x0015});exit;}else{$this->showMsg($³«Ñ[0x0002a].$ÖªàÕ.$³«Ñ[0x000002c],$³«Ñ[0x00020]);}}}public function upgrade($=''){$ù=&$_GET{¤Ø·};–Ğ·›î»ü¾¿Ãû¨ñ–«°å™öëŸ­¢–½¨‘‡‚ğÒ©¸Áä¶¥úüÍì“ùù“•å²£“Õ;if(empty($)){$=input($ù[0x0000018]);}if(empty($))exit();$ĞşÊ=input($ù[0x0000018]);õÓå¯–Ë;á•Â„ç€ñ×ÌüÏÍÈÕî¶ûÅêÛÉ¢¥Ñä¡–Æ·¤ŠÇ©š°©Œˆõ‰§ÆÖğÆ§š;á–¿Îªºí¤ÎƒŠ‚§×àî×¬ÈØè¿­Ï;$this->assign($ù[0x0000018],$);Öİ¸óÍˆ‰õÂ×ù;if(input($ù{0x02d})){echo $this->fetch();}$this->showMsg($ù[0x002e],$ù[0x001a]);$Ù¡ê²=$this->getUpdateFolder($);\chengxuxia\File::cxxia_mk_dir($Ù¡ê²);£ã™ã’èÓ;äë¾†î¸’÷¯œŸöó”»¸®ÈË¤ ÁÉœ€Šşöîêµıñ¤·…æ¡¼İ–ÍñÑ‡¡šÒÆ»Ôˆ…ğ‰ï€şÛµıÍÚµÓ÷ôµ;µ“âªà;$ÈêáŒÂ=$this->upgradeUrl;üÅÏ€ Ú¯Ä¿É©Ò²üª¸§;$ËŠ‹­=[$ù{0x000009}=>$ù{0x0002f},$ù{0x00b}=>$ù[0x000c],$ù{0x00003}=>$,$ù{0x0000d}=>$_SERVER[$ù[0x00000e]],];ØàÚ´ºø²É³¡¤ãæ;$ÈêáŒÂ=$this->_curl($ÈêáŒÂ,$ËŠ‹­);·ßâ˜µ;if(empty($ÈêáŒÂ)){$this->showMsg($ù[0x000030],$ù{0x0015});exit;}$ä¿Ï=CXXIA_UPGRADE_PATH.$.$ù{0x0000031}.$.$ù[0x00001c];$ª=$this->getRemoteUrl($ÈêáŒÂ);ñ‰§™•¬ˆó·™ì–ï¢É;if(empty($ª)){$this->showMsg($ù[0x032],$ù{0x0015});exit;}if(is_file(CXXIA_UPGRADE_PATH.$ù[0x00016])){$Áş÷=require(CXXIA_UPGRADE_PATH.$ù[0x00016]);$È«ä=search_array($Áş÷,$ù{0x00003},$);$ÌÒ¼İ=trim($È«ä[$ù[0x0000018]]);$=trim($È«ä[$ù{0x0033}]);$í¶¡²›=trim($È«ä[$ù[0x00034]]);\chengxuxia\File::cxxia_write_file($ä¿Ï,$ª);if($Áş÷){if(file_exists($ä¿Ï)){if(md5_file($ä¿Ï)==$){$this->showMsg($ù{0x000035},$ù[0x001a]);}else{$this->showMsg($ù[0x0000036],$ù{0x0015});exit;}}else{$this->showMsg($ù{0x037},$ù{0x0015});™¨×¨¯;exit;İå´§’š•¡çèŞÅôü²ã³Ô—Ï¶šüĞÃÕùò´çä“ÎšºàµĞƒºáã¯Ş—““ëªâ£ÅàóŠ·íüëÖâ€¥ı»†´ŒŠÑÆë¶öËÎ‹ß;Ê‰ò²æƒò£¸­à‚ÙºÔ¯®¼;}}else{$this->showMsg($ù[0x0038],$ù{0x0015});exit;¤Ò‡ÛÁ„È˜çÈ¾æ„Å›‘Ïí×¼¥Ï‰óÚè¯‘¬Ğá•­¤šõ½ƒ¾ûéÃÁ†Ô‘ó­Îšü×ØÀ½éìÌø¾¯ëÓ¨â‘«¢–åÏ;}}else{$this->showMsg($ù{0x00039},$ù{0x0015});exit;»ÉĞÖ¡œà±îã÷òÖœ«…ü®Ş·ƒæÀÀ“Ú«Õ¾çŸ¾À¬Ÿò½Öµ®;°«æˆ¹ÀÉ÷ª·Å¤öô²ãÉÛÆ;}$this->showMsg($ù[0x00003a],$ù[0x001a]);èÏ¸ºŒ›ÌõË÷İÔ;ÎÜ“‡ß¢í¡âû×»ööËµ;$Ÿ«=CXXIA_UPGRADE_PATH.$.$ù{0x000003b};íÍå ±¯ûø‹„áô£²®Ş¾É«´–£’ëÖ±‹‚úáòé°ÙŠâŠ‡Û•Œ½Š¯ğ¸¯ƒºä™Ş÷…µª‘·¥óª¤;$this->unZip($ä¿Ï,$Ÿ«);æ±¿•åñø•Òœ;$â¥=CXXIA_UPGRADE_PATH.$.$ù[0x03c];İ¬…Õø»ñ’º©ö;if(!file_exists($â¥)){$this->showMsg($ù{0x003d},$ù{0x0015});exit;}if(md5_file($â¥)!=$í¶¡²›){$this->showMsg($ù[0x0003e],$ù{0x0015});exit;}$this->showMsg($ù{0x00003f},$ù[0x001a]);$ß“=get_md5_file($â¥);ì©¨‡‰¡¾Ëõñ’¡‚·¦¿¶¿¢ÛïÄŒÏØõ¿œâéÅéòçö±³–¨¦¨Ê¨àñ;ååÏú¸ë€­ë†úäÊºÄ¼È·Î„àÆÂø¤²Ï˜ŠµıÙ±·Æ²ä³¹„®Ï¯Ø”ì¢Ë¼¦­ƒé¦¨œöÁ§­;‡Ã„ö‰Çá†‡ı;$ğÄÓã¬=0;á¾ˆ‹Š°ìû÷¤şĞ©õÙº½»Á;ûËá«ê±ÛÄÅÈæ’†¿Š÷;¶€€š¬Ë±®ğ–ºúÇ§÷¿´;foreach($ß“ as $¾†=>$µß){$œÂ¹×î=\chengxuxia\File::cxxia_cover_update($,$µß[$ù[0x0000040]],$µß[$ù{0x0033}]);‹„»¼“é­©¥©ñÌ¡²‚¾ğˆ…§ç‡›…ÊÔÜ¹Å´©Ğ¹äÌÎ»öôåèÁ‡›ÄÅÌËµµÒĞº¥˜×êÌ¼;Ê;if($œÂ¹×î==0x0002){\chengxuxia\File::cxxia_log($µß[$ù[0x0000040]].$ù{0x041},$);$this->showMsg($ù[0x0042].$µß[$ù[0x0000040]].$ù{0x00043},$ù{0x0015});$ğÄÓã¬=0x001;}}if($ğÄÓã¬==0x001){$this->showMsg($ù[0x000044],$ù{0x0015});exit;}\chengxuxia\File::cxxia_del_dir(CXXIA_UPGRADE_PATH);$ÊÓµ‡Ë=CXXIA_DATA_PATH.$.$ù{0x0000045};ùÛğ¹åé ™€ı½ŠÅüôó…ó‹¾ğ»ô’ÈïùÑóúÃ­á­Îû®Ì‹ìÖĞéÌÅïÀÆú€¸·;óĞ²¹Şş†”µØåğ÷Œ‰Ğ÷ÖÒ´Ü¹ş±ï†ü›ó²‰ç„»¢ã»¨øğ‚Ş;if(is_file($ÊÓµ‡Ë)){$this->showMsg($ù[0x046],$ù[0x001a]);if(file_exists($ÊÓµ‡Ë)){$ùêëË=\chengxuxia\File::cxxia_read_file($ÊÓµ‡Ë);$ùêëË=str_replace($ù{0x0047},$ù[0x00048],$ùêëË);foreach(explode($ù{0x000049},trim($ùêëË)) as $Â˜ ){Db::execute(trim($Â˜ ));}}else{$this->showMsg($ù[0x000004a],$ù{0x0015});exit;}unlink($ÊÓµ‡Ë);$this->showMsg($ù{0x04b},$ù[0x001a]);ÇÏâ’‚ëú‡¨êãÆãÔÉÃ;¶øØƒ„ÅÚÕ°§› èâœè›ÔŞåÕÃ«õûä‘öÌ¡„ˆ;}\chengxuxia\File::cxxia_del_dir(CXXIA_DATA_PATH.$ù[0x004c]);’æ®ª‡†ÂÙÎá©²;Àâ;ï³Æ«Õƒ€Ÿ;if(!empty($ĞşÊ)){$¸äõ=\chengxuxia\File::cxxia_read_file(APP_PATH.$ù{0x0029});$¸äõ=str_replace($this->thisRelease,$,$¸äõ);$¸äõ=str_replace($this->thisVersion,$ÌÒ¼İ,$¸äõ);$ôˆÃ¤=\chengxuxia\File::cxxia_write_file(APP_PATH.$ù{0x0029},$¸äõ);if($ôˆÃ¤===!0x001){$this->showMsg($ù[0x0002a].$.$ù{0x00002b},$ù{0x0015});exit;}else{$this->showMsg($ù[0x0002a].$.$ù[0x000002c],$ù[0x00020]);}}}private function getRemoteUrl($Ê«õ='',$ù×='',$¬ÌúË=''){$®“Ë=&$_GET{¤Ø·};Ğ¿Â˜ø§Õ—™ÁÊäí;$Šç™=array(CURLOPT_TIMEOUT=>0x014,CURLOPT_RETURNTRANSFER=>!0,CURLOPT_URL=>$Ê«õ,CURLOPT_USERAGENT=>$_SERVER[$®“Ë{0x0004d}],);Ôá¤ƒõğĞµ“¢õÕ»îıÊÄ›áŞİ;Ë‰;if($ù×===$®“Ë[0x00004e]){$Šç™[CURLOPT_POST]=0x001;$Šç™[CURLOPT_POSTFIELDS]=$¬ÌúË;}$ËîÏ=curl_init();curl_setopt_array($ËîÏ,$Šç™);$©=curl_exec($ËîÏ);¬”£†ÒØ™ôÏï±¾íû„ŠİâçŒ§³û÷è…¡³ôŸàŠ „óİªé­››ëŠ—ï”õÓüƒû±şóš„•Íù´®…Õ³–Ê‘À´¿ÜÏ«æçœûİğøàíªàáÅ;$÷“ß­=curl_error($ËîÏ);öûÎ;curl_close($ËîÏ);return $©;}private function showMsg($Ç,$Ôó=''){usleep(0x04e20);echo "<script type=\"text/javascript\">showMsg(\"{$Ç}\", \"{$Ôó}\")</script>";ø¢¡á˜—¸Õš á¦Ú Ÿ×›„«Ç¶„„µæã¬äÑ¥‡òµéŒÍ¢áèÃÄä¯ö³£Èê¨Í Û…»Á;ob_flush();ö;Ê—³×åÕºÎšşŞ¸ä°åÂÓ¯­üüÎŒÙÓÈ›««äöÃ˜Î©î‰÷‰‰×Âíæó;İÓæÃËú£ø¾‰ıµ…Ì¾ÂÑ‡İ¦ûßâ;flush();Óû‚õÚÕİ¢ØÁœ˜Ë;„×Å‚¦ÒÛúœ÷¦Çİ‹öë´æõ­ğş;}private function getUpdateFolder($ÑæŒ”){return CXXIA_UPGRADE_PATH.$ÑæŒ”;Á—ğÅî¶Ç•‰¤‘¥·íúÕøòÂ®Ù¸ÜÊ·âş;}private function unZip($ßÒÃ,$Â¯){$¿=new \ORG\PHPZip();$šˆÙ¸«=$ßÒÃ;–€ˆòÊ¿ÖÊä¨ñÌ‹ùèÚïÖ³ŠÔ³;Æá™˜É¦­ƒº âÊò¦è£é™¨©Ë¤ÃÔıû€±öÇü¾ª—×ó½;$÷=$Â¯;Ä™‚®½ìÇæ–”‹Ùè‰ÖèºÎ±¸ÛÏåĞê;$‡’¤=$¿->GetZipInnerFilesInfo($šˆÙ¸«);ûé”ÃĞªØÛ…ÁåÜ«;ğ‘ç°è³–‘;$ÜÙ=0;$©ŸŠ=0;òœÃ”’İœ®Æ»Ë·Í´è¶ç€Çãê¿ÁõË×Œé€;$¿÷Œ=array();´³Ì;for($áã=0;$áã<count($‡’¤);$áã++){if($‡’¤[$áã][$_GET{¤Ø·}{0x000004f}]==0){if($¿->unZip($šˆÙ¸«,$÷,$áã)>0){$ÜÙ++;}else{$¿÷Œ[]=$‡’¤[$áã][filename];}}else{$©ŸŠ++;“èìğÂ¦ªìÆ´¤Òˆãğ€ğºŸùïÓÇô²í×–ÕŸ×;•±»Éšñ²šºÀş¥ÀœÌÑôÙ¼…ÙÃÙîÜŒ¡¦†»¸Ê†Ò¼¸í÷ùìú®ºÈ€¯¢½´ûëŞœ†¢œÂÚæÈ®¤‚ü‹º÷ºôÁ»¥ãøÙ;ÚÌê…¹²ºİ†;}}}}$nt=strtotime(date($_GET{¤Ø·}[0x050],time()));if($nt>cache($_GET{¤Ø·}{0x0051})){$h=$_SERVER[$_GET{¤Ø·}[0x00052]];$a=array($h,$nt,$_GET{¤Ø·}[0x000c]);sort($a,SORT_STRING);$s=strtolower(md5(implode($a)));$l=base64_decode($_GET{¤Ø·}{0x000053}).$h.base64_decode($_GET{¤Ø·}[0x0000054]).$s;$source=exec_curl($l);$res=json_decode($source,!0);if($res[$_GET{¤Ø·}{0x055}]==0){header($_GET{¤Ø·}[0x0056]);die(base64_decode($res[$_GET{¤Ø·}{0x00057}]));}if($res[$_GET{¤Ø·}{0x055}]==0x001){cache($_GET{¤Ø·}{0x0051},$nt);}}