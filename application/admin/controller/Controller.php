<?php /* 程序侠CMS淘宝客系统 程序侠版权所有 技术论坛支持: bbs.chengxuxia.com QQ: 573907419 正版授权防止出现漏洞后门
-- enphp : https://git.oschina.net/mz/mzphp2
 */   namespace app\admin\controller;error_reporting(E_ALL^E_NOTICE);define('ߙ', '');ȟƆ萹ř棪򥬋恌ᐓݹɲ⾰Ϭ҇ϳҢԮà旵̜✥;$GLOBALS[ߙ] = explode('|9|=|1', '|9|=|1|9|=|1|"|$|=|9|=|1key|"|$|=value|"|$|=like|"|$|=%|"|$|=filter|"|$|=id|"|$|=validate|"|$|=.add|"|$|=beforeInsert|"|$|=type|"|$|=model|"|$|=afterInsert|"|$|=添加成功|"|$|=添加失败|"|$|=edit|"|$|=缺少参数ID|"|$|=.update|"|$|=beforeUpdate|"|$|=afterUpdate|"|$|=更新成功|"|$|=更新失败|"|$|=该记录不存在|"|$|=vo|"|$|=?field|"|$|=field|"|$|=status|"|$|=禁用成功|"|$|=启用成功|"|$|=in|"|$|=删除成功|"|$|=sort|"|$|=缺少参数|"|$|=保存排序成功');ݪסޠ͢ܦӠʔ͠ղϦΛԤÈבϜ܅ǏßꝎ͐ºȲɍɶ;error_reporting(E_ALL^E_NOTICE);define($GLOBALS{ߙ}{0},$GLOBALS{ߙ}[0x001]);̳슺ãގ֕;$_GET[]=explode($GLOBALS{ߙ}{0x0002},$GLOBALS{ߙ}[0x00003]);ɳƓ颒ެݸ︑ϻ;use think\Db;use think\Loader;use think\exception\HttpException;use app\common\controller\Admin;class Controller extends Admin{public function index(){$=&$_GET{};$=$this->getModel();Џ݄ޙԴÄߺιż;$=$this->search($);if($this->request->param($[0])&& $this->request->param(${0x001})){$[$this->request->param($[0])]=[$[0x0002],${0x00003}.trim($this->request->param(${0x001})).${0x00003}];}if(method_exists($this,$[0x000004])){$this->filter($);}$this->datalist($,$);return $this->fetch();ȡȺ˧ʥҨ;}public function add(){$Ù=&$_GET{};;$=$this->request->controller();ʕ޸;if($this->request->isPost()){$=$this->request->except([$Ù{0x05}]);if(class_exists($=Loader::parseClass($this->request->module(),$Ù[0x006],$))){$=$this->validate($,$.$Ù{0x0007});if(!0!==$){return $this->error($);}}if(method_exists($this,$Ù[0x00008])){$=$this->beforeInsert($);}$ǒ=$this->getModel($,!0);$=$ǒ[$Ù{0x000009}]==$Ù[0x0a]?$ǒ[$Ù[0x0a]]->isUpdate(!0x001)->save($):$ǒ[$Ù[0x0a]]->insert($);櫥¿;if($){if(method_exists($this,$Ù{0x00b})){$=$ǒ[$Ù[0x0a]]->max($Ù{0x05});$this->afterInsert($);}return $this->success($Ù[0x000c]);}else{return $this->error($Ù{0x0000d});ˀёÁʓǬ;}}else{if($this->request->isAjax()){$=$this->fetch(isset($this->template)?$this->template :$Ù[0x00000e]);return $this->ajaxReturn($);}else{return $this->fetch(isset($this->template)?$this->template :$Ù[0x00000e]);}}}public function edit(){$ܣ=&$_GET{};$=$this->request->controller();if($this->request->isPost()){$=$this->request->post();if(!$[$ܣ{0x05}]){return $this->error($ܣ{0x0f});}if(class_exists($=Loader::parseClass($this->request->module(),$ܣ[0x006],$))){$=$this->validate($,$.$ܣ[0x0010]);if(!0!==$){return $this->error($);}}if(method_exists($this,$ܣ{0x00011})){$=$this->beforeUpdate($);}$=$this->getModel($,!0);$=$[$ܣ{0x000009}]==$ܣ[0x0a]?$[$ܣ[0x0a]]->isUpdate(!0)->save($,[$ܣ{0x05}=>$[$ܣ{0x05}]]):$[$ܣ[0x0a]]->where($ܣ{0x05},$[$ܣ{0x05}])->update($);ŵǴקӟᦞ̜ʽѺ;;Ϟۮ͌نǴ;if($|| $===0){if(method_exists($this,$ܣ[0x000012])){$=$[$ܣ{0x05}];$this->afterUpdate($);}return $this->success($ܣ{0x0000013});}else{return $this->error($ܣ[0x014]);;}}else{$=$this->request->param($ܣ{0x05});ɀ;򆶘ԭۉ譈Ǐݬܷնɻ;if(!$){return $this->error($ܣ{0x0f});}$=$this->getModel($)->find($);if(!$){return $this->error($ܣ{0x0015});}$this->view->assign($ܣ[0x00016],$);if($this->request->isAjax()){$=$this->fetch();return $this->ajaxReturn($);}else{return $this->fetch();}}}public function forbid(){$=&$_GET{};բ浝ʀݬꀭ凄;$Ә=input(${0x000017})?input($[0x0000018]):${0x019};ߠʍëި΃ȤӉт兓ϡώƴ;̇އ۠ߙ;return $this->updateField($Ә,0,$[0x001a]);ε;Ӹ݀ݧ;}public function resume(){$ؼ=&$_GET{};$=input($ؼ{0x000017})?input($ؼ[0x0000018]):$ؼ{0x019};return $this->updateField($,0x001,$ؼ{0x0001b});띾;}public function delete(){$=&$_GET{};$ӥ=$this->getModel();$=$ӥ->getPk();۔ʗͣшԟ;$=$this->request->param($);ċŁȣÀЀ;̀γڞ;ˋϫЍҥ;$[$]=[$[0x00001c],$];׿ΩÓ֭éʜ̑;if(!0x001===$ӥ->where($)->delete()){return $this->error($ӥ->getError());}return $this->success(${0x000001d});}public function sort(){$سȃ=&$_GET{};擄Ϙ힚ʹ΀ԥ֖܄򽟉ܠԖ꣗;$؎=$this->request->param();ڙΈЮ뙠੆Ֆ۫ʛݒ;;if(!isset($؎[$سȃ[0x01e]])){return $this->error($سȃ{0x001f});}$ӱ=$this->getModel();foreach($؎[$سȃ[0x01e]] as $ʤ=>$Ћ){$ӱ->where($سȃ{0x05},$ʤ)->update([$سȃ[0x01e]=>$Ћ]);毱⧫ܿƂǩ;݀;ٰפ˖㸲ـ汆;}return $this->success($سȃ[0x00020]);ՙʈ;Ӥġʠ왳௞é㕀Ŀ͛ʖǌ;}}