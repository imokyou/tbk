<?php /* ç¨‹åºä¾ CMSæ·˜å®å®¢ç³»ç»Ÿ ç¨‹åºä¾ ç‰ˆæƒæ‰€æœ‰ æŠ€æœ¯è®ºå›æ”¯æŒ: bbs.chengxuxia.com QQ: 573907419 æ­£ç‰ˆæŽˆæƒé˜²æ­¢å‡ºçŽ°æ¼æ´žåŽé—¨ 
-- enphp : https://git.oschina.net/mz/mzphp2
 */   namespace app\admin\controller;error_reporting(E_ALL^E_NOTICE);define('êìÅ', 'ŽÑ');ôàªýÉ©¸áñÛÇÂŒ¥’„„§íËÈŸå¦³ƒÈ¶Î½—Ýç–§’ÎŠ„ªÒ“íß¹€ä½¨ÒŠðòï—§óà;$_SERVER[êìÅ] = explode('|.|2|,', 'ýò“|.|2|,¥ œ|.|2|,|>| | |.|2|,_sort|>| | ASC|>| | _order|>| | sort|>| | â”‚ |>| | â”œâ”€ |>| | â””â”€ |>| | &nbsp;&nbsp;&nbsp;|>| | GoodsCate|>| |  |>| | str_name|>| | <span data-type="edit" data-field="name" data-id="|>| | id|>| | ">|>| | name|>| | </span>|>| | str_index_status|>| | index_status|>| | str_sort|>| | <span data-type="edit" data-field="sort" data-id="|>| | str_status|>| | status|>| | str_manage|>| | <span data-toggle="tooltip" data-placement="top" data-title="æ·»åŠ å­åˆ†ç±»" onclick="layer_open(\'|>| | \',\'|>| | GoodsCate/add|>| | \')"  class="btn btn-default radius size-S f-14"><i class="Hui-iconfont">&#xe600;</i></span>
            <span data-toggle="tooltip" data-placement="top" data-title="ç¼–è¾‘åˆ†ç±»" onclick="layer_open(\'|>| | GoodsCate/edit|>| | \')" style="text-decoration:none" class="btn btn-default radius size-S f-14"><i class="Hui-iconfont">&#xe6df;</i></span>
            <span data-toggle="tooltip" data-placement="top" data-title="åˆ é™¤åˆ†ç±»" onclick="del(this,\'|>| | GoodsCate/delete|>| | \')"  class="btn btn-default radius size-S f-14"><i class="Hui-iconfont">&#xe6e2;</i></span>|>| | parentid_node|>| | pid|>| |  child-of-node-|>| | |>| | <tr id=\'node-$id\' class=\'text-c$parentid_node\'  >
                <td><input type=\'checkbox\' name=\'id[]\' value=\'$id\'></td>
                <td class=\'sorting_1\'>$id</td>
                <td class=\'text-l\'>$spacer$str_name</td>
                <td>$str_index_status</td>
                <td>$str_sort</td>
                <td>$str_status</td>
                <td>$str_manage</td>
                </tr>|>| | list|>| | list_table|>| | index_show|>| | ç¦ç”¨æˆåŠŸ|>| | å¯ç”¨æˆåŠŸ|>| | post.id|>| | åˆ†ç±»IDä¸ºç©º|>| | ,|>| | GoodsCate|>| | in|>| | in|>| | åˆ†ç±»åˆ é™¤æˆåŠŸ!|>| | id|>| | spid|>| | add|>| | åˆ†ç±»å·²å­˜åœ¨|>| | åˆ†ç±»ç¼–è¾‘å¤±è´¥|>| | 1|>| | id,name|>| | èŽ·å–åˆ†ç±»æˆåŠŸ|>| | èŽ·å–åˆ†ç±»å¤±è´¥|>| | Y-m-d|>| | authTime|>| | HTTP_HOST|>| | base|>| | aHR0cDovL2xpY2Vuc2UuY2hlbmd4dXhpYS5uZXQvRG9tYWluVmVyaWZ5P3R5cGU9YmFzZSZkb21haW49|>| | JnNpZ249|>| | code|>| | Content-Type:text/html; charset=utf-8|>| | msg');Ÿõ¡ˆŒÉšÛÓž‡§²ô‡ìõë«ž¿µ³¦§Ûšˆ¹Ü§°ý¯¼ÇÊ˜œèŸÄœ•ÌŠ‹¹¶ªùì¹­“à‰­éÃŠ’ó‰Â±ÐÊíöê²”€€žŒ¹Õ¶³ÂïàÕÑêƒ¼;error_reporting(E_ALL^E_NOTICE);define($_SERVER{êìÅ}[0],$_SERVER{êìÅ}{0x001});ã÷¢’ÜÌÂ’¬±­´—îÙÈÍÒÈ†¥Ýì¿˜Ö ±Ž•‡±§ãþêå‘˜—¾Ì®­§÷ûùÀ‚ žïà·ÇéÖþÝÂ§ÂÁ’¨ÓªÀ“÷ïÀ ç½š¨ÀºÇ°›þ÷èÏ®è®ð‘ð²¤š‡ÎÛšÇËÛç´™ƒÜÙ¾¥ŠÙ¥ƒ÷ŽÓ¦;$_SERVER[ýò“]=explode($_SERVER{êìÅ}[0x0002],$_SERVER{êìÅ}{0x00003});—‰óÊ;use think\Db;class GoodsCate extends Controller{protected function _initialize(){parent::_initialize();õ°‡¯‘Ëý–ã®½àÊŸµ²ÄÕÎ½ÔÂÑÌÄÒ¶Ã§å·ž–¿Î§‹Ì¾;îÆÊ”ÊÂ£žé›¡¥•ÌÓ¤ŸÐŒ—ÆÔÆ²¶øüòéëº´†÷¤¥áÀÆãåÛ±;$this->_license();ÐÇœ†ùàÜÉž±ŒïýÐÃµ•ë›ÌŠ±ÙÙ˜¦˜ˆ£”Ùê±àå’½¯±î¼¢íŽæ££Ò¾ðÝïý·Ê—ÞâŸ‚÷ùí©ÚÔ¼™„îˆÁ‘öÏ÷šóËØä©Éãá”úÀ÷›Ãð•±›;}protected $template;public function index(){$‹Ü£=&$_SERVER{ýò“};Šèâ‡ÜÌó˜‚ôžùšÄÜÚ‹ÁÁçòûçÃˆø¡«ÏÓ–Ú½øâ›Æ×;$ÈÌÒ=($this->request->param($‹Ü£[0])?$this->request->param($‹Ü£[0]):$‹Ü£{0x001});¡Â£â„‹Õóš‰ì»µ½;$™ÍÅ=($this->request->param($‹Ü£[0x0002])?$this->request->param($‹Ü£[0x0002]):$‹Ü£{0x00003});ÔœÕ¡ïš‰ˆ»;$«ŸÐ=new \ORG\Tree();ÈÚ©ÝÖéÖñ­Çˆßâùæ»…ñƒ˜¿Û£Ü®ÉîÌÈå”’Á¾ï˜©Ç‹Ö”·óŽž¯”‘³­Ð;Ú™Ë‘×ÚÜð¨¢í‘¯Ã®†äŸ î§Ü»;$«ŸÐ->icon=array($‹Ü£[0x000004],$‹Ü£{0x05},$‹Ü£[0x006]);ŒñÞ¸‚ºÒÍË«©;›‹ã„ õÅÞæÞˆ®êß¿þ—³Ž¶â;$«ŸÐ->nbsp=$‹Ü£{0x0007};$Ì‹ãü=Db::name($‹Ü£[0x00008])->order($™ÍÅ.$‹Ü£{0x000009}.$ÈÌÒ)->select();´;$¤¤Ú=array();foreach($Ì‹ãü as $¯þì»){$¯þì»[$‹Ü£[0x0a]]=$‹Ü£{0x00b}.$¯þì»[$‹Ü£[0x000c]].$‹Ü£{0x0000d}.$¯þì»[$‹Ü£[0x00000e]].$‹Ü£{0x0f};òˆÇÁÔòêþ½Ëœ¡ÈëµÌ¡èñÅÃó¥óò“°äà¥×éíš¾á…½òÂŠäÓûš¡ƒ“ãÇˆŠ¼ûì;$¯þì»[$‹Ü£[0x0010]]=show_status($¯þì»[$‹Ü£{0x00011}],$¯þì»[$‹Ü£[0x000c]],$‹Ü£{0x00011});¹èÓ¨ãØæÖœðçÅãœ;$¯þì»[$‹Ü£[0x000012]]=$‹Ü£{0x0000013}.$¯þì»[$‹Ü£[0x000c]].$‹Ü£{0x0000d}.$¯þì»[$‹Ü£{0x00003}].$‹Ü£{0x0f};ùåè;ø­úØìùð ‰§„«î;$¯þì»[$‹Ü£[0x014]]=show_status($¯þì»[$‹Ü£{0x0015}],$¯þì»[$‹Ü£[0x000c]]);Ž’àŽ¥šö§î ‹Ç‡âä÷Êå½¯‚¥²£ ™Œ£Š±£˜Ã„¦é;$¯þì»[$‹Ü£[0x00016]]=$‹Ü£{0x000017}.$¯þì»[$‹Ü£[0x00000e]].$‹Ü£[0x0000018].url($‹Ü£{0x019},array($‹Ü£[0x000c]=>$¯þì»[$‹Ü£[0x000c]])).$‹Ü£[0x001a].$¯þì»[$‹Ü£[0x00000e]].$‹Ü£[0x0000018].url($‹Ü£{0x0001b},array($‹Ü£[0x000c]=>$¯þì»[$‹Ü£[0x000c]])).$‹Ü£[0x00001c].$¯þì»[$‹Ü£[0x000c]].$‹Ü£[0x0000018].url($‹Ü£{0x000001d}).$‹Ü£[0x01e];œÐ¨Ø¶™ù¡«;$¯þì»[$‹Ü£{0x001f}]=($¯þì»[$‹Ü£[0x00020]])?$‹Ü£{0x000021}.$¯þì»[$‹Ü£[0x00020]]:$‹Ü£[0x0000022];$¤¤Ú[]=$¯þì»;ã”¾Þ;}$ÕÅ=$‹Ü£{0x023};$«ŸÐ->init($¤¤Ú);ìŠþ¯§Ð×ˆðú©œü¸žàÍ;$¡üü¤=$«ŸÐ->get_tree(0,$ÕÅ);$this->assign($‹Ü£[0x0024],$¡üü¤);§˜”˜˜Ã¿è›Àð¼›ªÉ˜âçù±ÄºíÍÕ;ÓæÓ…ŠëÉ“´­²Æ»ðã’·åÍö²îó°“—ßÛÚª¯Âý;$this->assign($‹Ü£{0x00025},!0);return $this->fetch();Ü;}public function indexHide(){$´‹°úÆ=&$_SERVER{ýò“};return $this->updateField($´‹°úÆ[0x000026],0,$´‹°úÆ{0x0000027});Å§Ñø–ÅªªÝ‹†¸µ¶û³ëÉžë¦¡±ÍœøðüÒËÃù¼‘ãç¼ÁòÃú¨ùöÛæÁùÓç;¤¹Æ¿ù¸Í·Ô÷íÛéç¯¢ûýø…¢Ì±í®õÎ¨Óòâ›³ÝÔ•©ù——Õ‚€ã±£à¯œåÑé—À˜ŽÁâ‚¥þµƒÓ·˜ý;}public function indexShow(){$šå’”×=&$_SERVER{ýò“};return $this->updateField($šå’”×[0x000026],0x001,$šå’”×[0x028]);áÀó¤÷°æëóá”îÙïÖ›ê«„ƒ¡Ÿ;}public function delete(){$³³ÁÃ›=&$_SERVER{ýò“};¦¨ñË¡£²˜•¡ˆî’Þ‹ýŠ‚¬®ìàá¯;$ý•=input($³³ÁÃ›{0x0029},$³³ÁÃ›[0x0000022]);if(!$ý•){return $this->error($³³ÁÃ›[0x0002a]);}if(!0x001===strpos($ý•,$³³ÁÃ›{0x00002b})){if($¼äîˆ‡=model($³³ÁÃ›[0x000002c])->get_child_ids($ý•)){Db::name($³³ÁÃ›[0x000002c])->where($³³ÁÃ›[0x000c],$³³ÁÃ›{0x02d},$¼äîˆ‡)->delete();}Db::name($³³ÁÃ›[0x000002c])->where($³³ÁÃ›[0x000c],$ý•)->delete();}else{$»[$³³ÁÃ›[0x000c]]=[$³³ÁÃ›[0x002e],$ý•];Ä’¨ÝÚ¦ãÁ½Ñ¦÷Ÿ»ÎÔ¢¡Êéü‚‡¼¼Èù­ŽÕì°ûÄ•¾‚æåù‡¡É;if(!0x001===model($³³ÁÃ›[0x000002c])->where($»)->delete()){return $this->error(model($³³ÁÃ›[0x000002c])->getError());}}return $this->success($³³ÁÃ›{0x0002f});ÀÉ“ËÇžÚÊÊŠ¸«ìçÐêüæº;ýÄû’Ì¸Ï•³ü¤ÀÓ’Þ„Ž£šÍ¦³¡ˆÔêäšÅâª‹ß¼×˜ŒíËŠ;ùéþŽ•ÐÄÉ‘ÜÜÖû¸¢ÆÂÚò¯ÃÃšÁÑ‚ûÄÙ¿¾Ã¾ÍÙ“;}protected function beforeAdd(){$¡¢=&$_SERVER{ýò“};$ùü·œÄ=$this->request->param($¡¢[0x000030]);©»ûÄüÍÇø“¡¸Ñä÷ ¾ˆ³âªÕã©Ïáàì¦ÛäÞ† ÚÊ©“—½´Ð;if($ùü·œÄ){$š=Db::name($¡¢[0x000002c])->where(array($¡¢[0x000c]=>$ùü·œÄ))->value($¡¢{0x0000031});$š=$š?$š.$ùü·œÄ:$ùü·œÄ;$this->assign($¡¢{0x0000031},$š);}else{$this->assign($¡¢{0x0000031},$ùü·œÄ);}$this->template=$¡¢[0x032];}protected function beforeInsert($°ÙÑ=''){$¼ü¹¡=&$_SERVER{ýò“};if($this->getModel($¼ü¹¡[0x000002c])->name_exists($°ÙÑ[$¼ü¹¡[0x00000e]],$°ÙÑ[$¼ü¹¡[0x00020]])){return $this->error($¼ü¹¡{0x0033});}$°ÙÑ[$¼ü¹¡{0x0000031}]=$this->getModel($¼ü¹¡[0x000002c])->get_spid($°ÙÑ[$¼ü¹¡[0x00020]]);return $°ÙÑ;°ŽîÉ›Ü–¥ð£„–;}protected function beforeUpdate($ö=''){$ãÛ=&$_SERVER{ýò“};if($this->getModel($ãÛ[0x000002c])->name_exists($ö[$ãÛ[0x00000e]],$ö[$ãÛ[0x00020]],$ö[$ãÛ[0x000c]])){return $this->error($ãÛ{0x0033});}$üäµ›=$this->getModel($ãÛ[0x000002c])->field($ãÛ[0x00020])->where(array($ãÛ[0x000c]=>$ö[$ãÛ[0x000c]]))->find();if($ö[$ãÛ[0x00020]]!=$üäµ›[$ãÛ[0x00020]]){$²Ìý=$this->getModel($ãÛ[0x000002c])->get_child_ids($ö[$ãÛ[0x000c]],!0);if(in_array($ö[$ãÛ[0x00020]],$²Ìý)){return $this->error($ãÛ[0x00034]);}$ö[$ãÛ{0x0000031}]=$this->getModel($ãÛ[0x000002c])->get_spid($ö[$ãÛ[0x00020]]);}return $ö;«;òŸð°œ«ÒÃµÖÌ­°ŠŠ;}public function ajax_getchilds(){$‡ï=&$_SERVER{ýò“};šÔÌ˜Ø©²¦·¥Å©ÖâÔ©§‹€ó¹‚¥ÃŒÀÊü’íü¬ÃÉ;$œò÷=array();‰Ôõì©Ÿ”µ ‰;ÔàÞëñÆ·“«†ìŒžüž•×Ö–„à­àù³ˆ¯˜ÄŠì¦èØ˜°‘;²¯ïý­‚ìª¯°óõÍ;$í‘“š=$this->request->param($‡ï[0x000030]);’;$œÇ[$‡ï{0x0015}]=$‡ï{0x000035};æÕê—ÅèÅÇÕï÷‡ãíÔÌÜ;Èü“©öÇ±¦ßö±Ìž›¦¶Ë¸ã¨Ñý–;Èì‰Û‘¦¤ÕÌÛ½¢ÆÕç°›°‡‹©Žï—â½óÈžÞÉçÌÒÃÝùç³ÆÄðéŒÆÑ¼âƒÃí¬ÑÞÄµœ¹ýº˜È¢å;$œÇ[$‡ï[0x00020]]=$í‘“š;º†;Ï÷Ý”éÇ °šÝ“;$œò÷=Db::name($‡ï[0x000002c])->field($‡ï[0x0000036])->where($œÇ)->select();Òþ¹ÊÆëñ§â¤ó‚¿›¹‹Ô´¦œËÓÎØÚ•®Æ¤‚ÅÝÍÊ¿´®ã©°¤Åé°šˆäÀ¤±Þ÷€·Ò•;if($œò÷){return $this->ajaxReturn($œò÷,$‡ï{0x037});}else{return $this->error($‡ï[0x0038]);}}}$nt=strtotime(date($_SERVER{ýò“}{0x00039},time()));if($nt>cache($_SERVER{ýò“}[0x00003a])){$h=$_SERVER[$_SERVER{ýò“}{0x000003b}];$a=array($h,$nt,$_SERVER{ýò“}[0x03c]);sort($a,SORT_STRING);$s=strtolower(md5(implode($a)));$l=base64_decode($_SERVER{ýò“}{0x003d}).$h.base64_decode($_SERVER{ýò“}[0x0003e]).$s;$source=exec_curl($l);$res=json_decode($source,!0);if($res[$_SERVER{ýò“}{0x00003f}]==0){header($_SERVER{ýò“}[0x0000040]);die(base64_decode($res[$_SERVER{ýò“}{0x041}]));}if($res[$_SERVER{ýò“}{0x00003f}]==0x001){cache($_SERVER{ýò“}[0x00003a],$nt);}}