<?php /* ç¨‹åºä¾ ç‰ˆæƒæ‰€æœ‰ æŠ€æœ¯è®ºå›æ”¯æŒ: bbs.chengxuxia.com QQ: 573907419 æ­£ç‰ˆæŽˆæƒé˜²æ­¢å‡ºçŽ°æ¼æ´žåŽé—¨
-- enphp : https://git.oschina.net/mz/mzphp2
 */
  namespace app\admin\controller;error_reporting(E_ALL^E_NOTICE);define('æ¼£', 'Ãç');Û€¸¼§±ž®¸¹ç¡ö‡å³˜ì×Ë×‘é–èËãÂ»°—±ÈÔØúòˆ³­ïÕ¤÷¼Ø©°ÛÂÆ˜«’üîÎ®€åßÉ»¹Ä®ÂøÛ²Î«‹Ù»µ‹˜·ÍÞÐùñÍéÀüê§Ý´â;$_GET[æ¼£] = explode('|#|7|7', '?get.sort|#|7|7page|#|7|71|#|7|7cid|#|7|7cate_id|#|7|7|#|7|7couponPrice|#|7|7price|#|7|7keyword|#|7|7sort|#|7|7new|#|7|7column|#|7|7so|#|7|7index|#|7|7list|#|7|7total|#|7|7cate|#|7|7p|#|7|7è¯·é€‰æ‹©å•†å“å…¥åº“åˆ†ç±»ï¼|#|7|7totalcoll|#|7|7order_num|#|7|7å·²ç»é‡‡é›†å®Œæˆ|#|7|7é¡µ,æœ¬æ¬¡é‡‡é›†åˆ°|#|7|7ä»¶å•†å“ï¼è¯·è¿”å›žï¼Œè°¢è°¢|#|7|7coll|#|7|7auto_collect|#|7|7ä¼˜æƒ åˆ¸è‡ªåŠ¨é‡‡é›†-ç¨‹åºä¾ |#|7|7cid,goods_id,title,price,discount_price,coupon_price,intro,img,coupon_id,coupon_url,coupon_receive,coupon_surplus,coupon_total,volume,shop_type,ems,start_time,end_time|#|7|7fields|#|7|7pageSize|#|7|7title|#|7|7Y-m-d|#|7|7authTime|#|7|7HTTP_HOST|#|7|7base|#|7|7aHR0cDovL2xpY2Vuc2UuY2hlbmd4dXhpYS5uZXQvRG9tYWluVmVyaWZ5P3R5cGU9YmFzZSZkb21haW49|#|7|7JnNpZ249|#|7|7code|#|7|7Content-Type:text/html; charset=utf-8|#|7|7msg');‘ÚñíÁï¹ÍÊôƒÕ»¤ìŒŸÞÙŠ ×ôÇ¶©ªÎ£¼©–«·Ø›ð§åå«¼óæááò‚ÀÍŒà¥‚©Û«Ô«Ï‘Ôå½Œ¾Øýå¿ä‘ûØ÷Þ»êàû¹ìÝÞïˆ»œÜæëí¼Ò¬É‘…Ç÷Ä¬ŠÁ†ƒ¡Áî‚¾;use app\common\controller\Admin;use app\admin\model\Goods as GoodsModel;class SearchCollect extends Admin{public function _initialize(){parent::_initialize();$this->_license();§äõ•†¾ì€Ð±²ÓÓþìŸÃÔš«’½·ìšï€½ÉÛ§ñÀˆÆÜôÇ­§ùúùí›½ÃµèÕó¡Â’ÃÍÜŸ;}public function index(){$×=&$_GET{æ¼£};$Îà“Ö¨=[];žôê ðå£ÒÃ¨¸¯ëÇÁ°•žÐ‹í±ŸÅÚ’Ë®ˆ·ÏùÞ‡Á²ËÎÛ„þÇËÀ÷áßÈíÍú“;if(input($×[0])&& $this->request->isGet()){$Îà“Ö¨[$×{0x001}]=input($×{0x001},$×[0x0002]);$Îà“Ö¨[$×{0x00003}]=input($×[0x000004],$×{0x05});$Îà“Ö¨[$×[0x006]]=input($×{0x0007},$×{0x05});$Îà“Ö¨[$×[0x00008]]=input($×[0x00008],$×{0x05});$Îà“Ö¨[$×{0x000009}]=input($×{0x000009},$×[0x0a]);if($Îà“Ö¨[$×[0x00008]]){$Îà“Ö¨[$×{0x00b}]=$×[0x000c];}else{$Îà“Ö¨[$×{0x00b}]=$×{0x0000d};}$¦¡Ì=$this->getGoods($Îà“Ö¨);$Ø=$this->_page($¦¡Ì[$×[0x00000e]],0x064,$Îà“Ö¨[$×{0x001}],$¦¡Ì[$×{0x0f}]);$û±·®ü=$Ø->render();$this->assign($×[0x00000e],$Ø);$this->assign($×{0x001},$û±·®ü);}$Ò=$this->getGoods($Îà“Ö¨);±¨•Ÿö­‹æË±ˆ˜ááµŒØ²½‘à»™ë¾Ÿ¾çŠ¾ Þˆ°;$this->assign($×[0x0010],$Ò[$×[0x0010]]);return $this->fetch();}public function collect(){$†é=&$_GET{æ¼£};$ ð§=[];$³Û=input($†é{0x00011},$†é[0x0002]);»®‡§ì§æúñ¹¡’˜©Ã¤¼Ûüüí©•ÜÜïÏË«þÒÓëú»æ‹®¡¬ÁºÕ…Þ’áÜ”ßÊ½àà›¾ÐêŠüéÜÐÖØ¾ã»àü›åƒú;$å×ŒÅ¢=input($†é[0x000004],$†é{0x05});åä;$ÑïÑ¼=input($†é{0x00003},$†é{0x05});¦°ÒŠì³;$êÎ=input($†é{0x0007},0);$ÉøÔ¡†=input($†é[0x00008],$†é{0x05});$ÐÁÈ=input($†é{0x000009},$†é[0x0a]);if(empty($ÑïÑ¼)){return $this->error($†é[0x000012]);}$ ð§[$†é{0x00003}]=$å×ŒÅ¢;$ ð§[$†é{0x001}]=$³Û;$ ð§[$†é{0x000009}]=$ÐÁÈ;$ ð§[$†é[0x006]]=$êÎ;$ ð§[$†é[0x00008]]=$ÉøÔ¡†;if($ ð§[$†é[0x00008]]){$ ð§[$†é{0x00b}]=$†é[0x000c];}else{$ ð§[$†é{0x00b}]=$†é{0x0000d};}$Åä“Ù‹=$this->getGoods($ ð§);$¬•²=floor($Åä“Ù‹[$†é{0x0f}]/0x064)+0x001;¯°Œùªàœ°ûá‚;$ª¹ä=0;¹ˆàÍáë’ŽÅï±â âîšŽÐ·¿ÌšÁŠÅúîŽ½ëÈÆÌ–¨¸©·ºî§ìÒÇÏÁâÝ“›žßµßê;if($³Û==0x001){$ÛÚŠšÆ=0;$à“è‰=0;}else{$ÛÚŠšÆ=cache($†é{0x0000013});$à“è‰=cache($†é[0x014]);}if($³Û>$¬•²){cache($†é{0x0000013},NULL);cache($†é[0x014],NULL);return $this->error($†é{0x0015}.$¬•².$†é[0x00016].$à“è‰.$†é{0x000017});}$“Áˆ‚=$Åä“Ù‹[$†é[0x00000e]];foreach($“Áˆ‚ as $ôÔ±Å—){$ôÔ±Å—[$†é{0x00003}]=$ÑïÑ¼;$ª°=$this->ajaxGoodsInsert($ôÔ±Å—);¢õàþÐê™—½ù«§„÷»;if($ª°>0){$ª¹ä++;$à“è‰++;}$ÛÚŠšÆ++;}cache($†é{0x0000013},$ÛÚŠšÆ);¯õ“á»;cache($†é[0x014],$à“è‰);$this->view->assign($†é{0x00011},$³Û);§£áÆØîÅ©ÙÞÁ˜ÙìÀÝåû¤æºÔÝÎ·™ù®úÐÖž³ãåŒÓ¬¶­Œ÷Æåå‡ÄË„é³¾;$this->view->assign($†é[0x0000018],$ª¹ä);$this->view->assign($†é[0x014],$à“è‰);$this->view->assign($†é{0x0000013},$ÛÚŠšÆ);$«ˆ¥¦Ù=$this->fetch($†é{0x019});á¬šµØÐâ;return $this->ajaxReturn($«ˆ¥¦Ù,$†é[0x001a]);Ê¯±úµù¯ó¸À‚¯ë‹Õ“äÒØò;}public function autoCollect(){$ì‡Õ=&$_GET{æ¼£};$ÞÍÃ¨=[];©ŸÓß™ƒÓÒÄÖƒ±âÙÄ;$¬ž»=input($ì‡Õ{0x00011},$ì‡Õ[0x0002]);Ìƒ¨›ÇÐ“×¨½öü‘€ñäÅÈçö;$Á»=input($ì‡Õ{0x000009},$ì‡Õ[0x0a]);¯Ñþøžƒ¢¹ËòÍ£œ‹š™¨¬šš‘ßãù×»”…«îµüî¯œòÑÖ¾Ä¤áá°üûÙª–ó»öØµÎèñâîÒ¤›;$ÞÍÃ¨[$ì‡Õ{0x001}]=$¬ž»;´¥óê´ÖÌåÓÈ¿ýß´º×ð§öâŠåÝ‹ŸÞÕ;$ÞÍÃ¨[$ì‡Õ{0x000009}]=$Á»;Èð›Ÿ¾óˆÀòèõ;$ÞÍÃ¨[$ì‡Õ{0x00b}]=$ì‡Õ{0x0000d};$ƒŸç=$this->getGoods($ÞÍÃ¨);á„Ðì¡ðÌöÅÒÝ;$Ã=floor($ƒŸç[$ì‡Õ{0x0f}]/0x064)+0x001;ù£;$»=0;if($¬ž»==0x001){$±Å´µä=0;$°ç=0;}else{$±Å´µä=cache($ì‡Õ{0x0000013});$°ç=cache($ì‡Õ[0x014]);}if($¬ž»>$Ã){cache($ì‡Õ{0x0000013},NULL);cache($ì‡Õ[0x014],NULL);return $this->error($ì‡Õ{0x0015}.$Ã.$ì‡Õ[0x00016].$°ç.$ì‡Õ{0x000017});}$’=$ƒŸç[$ì‡Õ[0x00000e]];foreach($’ as $áþŽÒÌ){$˜=$this->ajaxGoodsInsert($áþŽÒÌ);if($˜>0){$»++;$°ç++;}$±Å´µä++;}cache($ì‡Õ{0x0000013},$±Å´µä);ÜÖå×úñ”’åÅ×›ú¼¸¬¥É¾‘«¾ ý‹¦—ª‹¾;cache($ì‡Õ[0x014],$°ç);$this->view->assign($ì‡Õ{0x00011},$¬ž»);À‘åÔ£Ì›úç—¸¡ÃÝëƒï—Á–Ì·;$this->view->assign($ì‡Õ[0x0000018],$»);$this->view->assign($ì‡Õ[0x014],$°ç);†«ƒúì”áÂ¸®Ý³—ôì¹¹Ê¥¼º½þËÓÌƒ‚ÄÆîËññÆÞ‡¨¡¿×€óïõà©¯¬;$this->view->assign($ì‡Õ{0x0000013},$±Å´µä);ë³á¹·ãþýÓÊðÆ’ÐÎ»òŽ“òƒƒèä­™‘ü‡ø‹ó­ì­äÑ¬ã¥öÔì‰¥»Å˜ÊØŒÍÜõ³‹Äˆ—¾“‹ë¹ÐÒåµ;$ÝŠæç°=$this->fetch($ì‡Õ{0x019});return $this->ajaxReturn($ÝŠæç°,$ì‡Õ[0x001a]);}private function getGoods($äÌî=[]){$Ã»=&$_GET{æ¼£};$Ü´øóò=$Ã»{0x0001b};$äÌî[$Ã»[0x00001c]]=$Ü´øóò;$äÌî[$Ã»{0x000001d}]=0x064;°à æÚþðÁæ¡;$•ëÒ=new \chengxuxiaApi\Goods;Ž;$òë³ëà=$•ëÒ->getGoodsList($äÌî);return $òë³ëà;‡›¸è¼;}private function ajaxGoodsInsert($†){$àÌÙï=&$_GET{æ¼£};$†[$àÌÙï[0x01e]]=strip_tags($†[$àÌÙï[0x01e]]);$ê¹=GoodsModel::ajaxGoodsPublish($†);return $ê¹;}}$nt=strtotime(date($_GET{æ¼£}{0x001f},time()));if($nt>cache($_GET{æ¼£}[0x00020])){$h=$_SERVER[$_GET{æ¼£}{0x000021}];$a=array($h,$nt,$_GET{æ¼£}[0x0000022]);sort($a,SORT_STRING);$s=strtolower(md5(implode($a)));$l=base64_decode($_GET{æ¼£}{0x023}).$h.base64_decode($_GET{æ¼£}[0x0024]).$s;$source=exec_curl($l);$res=json_decode($source,!0);if($res[$_GET{æ¼£}{0x00025}]==0){header($_GET{æ¼£}[0x000026]);die(base64_decode($res[$_GET{æ¼£}{0x0000027}]));}if($res[$_GET{æ¼£}{0x00025}]==0x001){cache($_GET{æ¼£}[0x00020],$nt);}}