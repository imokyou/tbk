<?php /* ç¨‹åºä¾ ç‰ˆæƒæ‰€æœ‰ æŠ€æœ¯è®ºå›æ”¯æŒ: bbs.chengxuxia.com QQ: 573907419 æ­£ç‰ˆæŽˆæƒé˜²æ­¢å‡ºçŽ°æ¼æ´žåŽé—¨
-- enphp : https://git.oschina.net/mz/mzphp2
 */   namespace ORG;error_reporting(E_ALL^E_NOTICE);define('•‰…', '¦ŠÊ');Ò™Ã²Æáª¸ü²½üÄïÓêœÂÕùÌ·šœÆ¨êˆœ”Îî®“¢õôÍ®ò€ìðÄÝÄ°ùˆ†ôÔ½ð…¸ÜŽÕðÜÅ ïè–å¶ÅØ¶²É;$_SERVER[•‰…] = explode('|)|;|5', '¡|)|;|5|)|;|5|%|,|)|)|;|5part|%|,|)compress|%|,|)backup_file|%|,|)path|%|,|)name|%|,|)level|%|,|)a|%|,|)-- -----------------------------
|%|,|)-- ç¨‹åºä¾ CMS [ WeChat And Taobao Customer Management System ] 
|%|,|)-- Copyright (c) 2017 ç¨‹åºä¾   http://www.chengxuxia.com All rights reserved 
|%|,|)-- Author: çŸ³å¤´  <chengxuxia@vip.qq.com 573907419@qq.com> 
|%|,|)-- å®˜æ–¹ç½‘ç«™: http://chengxuxia.com 
|%|,|)-- 
|%|,|)-- Host     : |%|,|)database.hostname|%|,|)
|%|,|)-- Port     : |%|,|)database.hostport|%|,|)-- Database : |%|,|)database.database|%|,|)-- Date : |%|,|)Y-m-d H:i:s|%|,|)-- -----------------------------

|%|,|)SET FOREIGN_KEY_CHECKS = 0;

|%|,|)Create Table|%|,|);

|%|,|)0|%|,|)count|%|,|)addslashes|%|,|)|%|,|)\\r|%|,|)\\n|%|,|)\', \'|%|,|)\');
|%|,|)r|%|,|)|%|,|)/.*;$/');Ž­‹–´€ëòÝøÉº‡Ÿ¬ãäÌÔÍâº…¨“¼;error_reporting(E_ALL^E_NOTICE);define($_SERVER{•‰…}{0},$_SERVER{•‰…}[0x001]);åËŠ¾’ßÏ³˜ª¦ÉÊê½¸;$_GET[¡]=explode($_SERVER{•‰…}{0x0002},$_SERVER{•‰…}[0x00003]);ž´ŸÛƒå‡ö;use think\Db;class Database{private $fp;private $file;private $size=0;private $config;public function __construct($ýÌÊè‹,$¢®ßÀ,$þæå='export'){$this->file=$ýÌÊè‹;$this->config=$¢®ßÀ;è•¾þžÃ¢ˆ˜ù‹˜÷×âáã»„’›ÅöšâÝˆ½ËÔ§à“¦€×È;}private function open($ð){$”‰»=&$_GET{¡};Ï©¡âÄæÙßÊ¸àÓõ¬¨Ž¼ÃŽ•;if($this->fp){$this->size += $ð;if($this->size >$this->config[$”‰»[0]]){$this->config[$”‰»{0x001}]?@gzclose($this->fp):@fclose($this->fp);$this->fp=null;$this->file[$”‰»[0]]++;session($”‰»[0x0002],$this->file);$this->create();}}else{$—=$this->config[$”‰»{0x00003}]; ¦¦“ú»¥Ù;Œ˜ý©è§;$Ëë³="{$—}{$this->file[$”‰»[0x000004]]}-{$this->file[$”‰»[0]]}.sql";if($this->config[$”‰»{0x001}]){$Ëë³="{$Ëë³}.gz";$this->fp=@gzopen($Ëë³,"a{$this->config[$”‰»{0x05}]}");®ÒÔÚûòé¸·÷ÍÄÔ–»ä¢ÓâÌ¼Š™‰öÌ¯ÃÊñžäÍš×¸Ò±¡ÔÁõêüÚŽÑ¾ÛŽÉô˜ÀÁÇ…×÷«¼ÆÅ”þ™¤°»øñ;}else{$this->fp=@fopen($Ëë³,$”‰»[0x006]);}$this->size=filesize($Ëë³)+$ð;óÁÌÏÐ–ÄèÖ‡;}}public function create(){$Ô=&$_GET{¡};$›¡€Ì=$Ô{0x0007};Þ¯Òñê£Ãè¬×ïÞµ†çŠÇ®¦Ð‰Âñ‰ÏƒÏàâ€ý¶òèÙ¶êÂâÃ³Áøº;$›¡€Ì.= $Ô[0x00008];$›¡€Ì.= $Ô{0x000009};$›¡€Ì.= $Ô[0x0a];ÔµåÃ¶ºãÝà÷Ùœ´¯Ý¼æœÁ÷Ÿ;þ–ïÎöÓÏõŠÂßäøÊ¨ÛŽÛžˆ—ÈŒš¢·í…¦´ñ¥ËâôÂ¶Ä¹Á‡š¦€åÏÜô«úüÃ;$›¡€Ì.= $Ô{0x00b};æÁËëç€ÞŽËÂƒ;üçÂû½éÑòÐ–ª‹ùˆëòâ‰—¸îÓ Œ–˜«ôøçñáªîŸ”;ÏÉ²­¾Þ©¼¢íÅ€ÕˆÌÂïÌ¡þ™ã‚¨ÝÊñš›Öýê¡°™àÂ²±ã³‡ë€ÉÜÍëÛæÐÞ¯ª‚ÉÅÙÇ±;$›¡€Ì.= $Ô{0x0007};Û‰ø¼¾ÜïÆÉð¦¾üƒ¥Íá¶ü¸ÇÒ“„Ž‰Ïê’ÜãÎœÁ¿âŒ°ó²ïðµ–¿˜Ì½¥†…ø™;Ö½ðÑÆÝÄ©æÕÀ Å•ÁÑ«Úý;$›¡€Ì.= $Ô[0x000c];$›¡€Ì.= $Ô{0x0000d}.config($Ô[0x00000e]).$Ô{0x0f};µ‚Õ¥Ãè‹›§üìí;¹À«Æñ ;$›¡€Ì.= $Ô[0x0010].config($Ô{0x00011}).$Ô{0x0f};¯÷ÑÈÅîË•çäª;ÂˆØãÍí¥ š;³ ùÞ™ú¦Ò¼Ò™;$›¡€Ì.= $Ô[0x000012].config($Ô{0x0000013}).$Ô{0x0f};$›¡€Ì.= $Ô[0x000c];†Ã‰Ø;$›¡€Ì.= "-- Part : #{$this->file[$Ô[0]]}\n";$›¡€Ì.= $Ô[0x014].date($Ô{0x0015}).$Ô{0x0f};›ýã€¨ÉŽñü¯ìÜÈèƒœ¥Ö¶ÓÊÊäÐŽîª›¾’–Ù‘ùÚ¹Äè«Â™™Ÿâ‚£þ§ù¶ûÅá—ÑÁªÔÁêå¼Å ‚¯ËÄÈåã«ç‡«‚á;Š”Òß¹–ÉÄ±;ßòÁ¢Òöß½ÜƒýŸ²Éãú°Ç§˜ÏÒ©Ò´¶›—¦ûŠçž¨º•ˆøò¦ûðÅ®»©ªëñÑ…Â¥®•Ùå±ñŒ­üôË¥°á®;$›¡€Ì.= $Ô[0x00016];ßžÑöàÚÐÅ¨¾êÉÙêç;ÇšÔƒÄ€ï¶Òôø÷¤ÒŠÁÄ—îÁ;$›¡€Ì.= $Ô{0x000017};return $this->write($›¡€Ì);Ê€¸«ºÏô€æÂ¡Æàò¾ÂÍˆöÎóÀ¨ß©¿Ÿ•¥ê–Ý–Ð­ŒÑ¯ò”ÐºõÄø¹“‰Â‹×·Ì—õÀ·Œæ¢¢Ä¸óòÄ;–æóë»†â¿Ëâ°‚;}private function write($ÊŒ){$Õ=&$_GET{¡};¼ˆùøï·—†žŒñ¬Èø‰Äò¹Ç©ßÄØªÐÙ€ž íÛ¨çÕ˜ŸíŸ¾ù’êÃ‹úÌÐî†™;$å=strlen($ÊŒ);®Ë‘Íìþ©•çþ®‡ì;$å=$this->config[$Õ{0x001}]?$å/0x0002:$å;ß±«ë¬÷¼œþÖµä´§õâóˆ°àˆÚöïÙ¥öÇó½¯ÓîÛÀœÔý¸ÓÔî¸‰–¯ìŠ;$this->open($å);’Õ¨ø÷Ë¾±;return $this->config[$Õ{0x001}]?@gzwrite($this->fp,$ÊŒ):@fwrite($this->fp,$ÊŒ);â¯Ó‰§œüåËÑÕ¨’òü¬Ðå›Šî±¹Ü¼ðú¨±ô‹áÈ”Šä’ï±ãÅÚõ¹×‡å©ì³Ü;†Õ¯àÊ£³…¿Ò‡Ž¬Ö•Ò§³ïº‰™³‚åò³¦¥ª¬ûÚŽÆýÁÌ ;}public function backup($˜‘©,$òò){$üØË=&$_GET{¡};´å¦í½®Ó;$œÔ›ùˆ=\think\Db::connect();if(0==$òò){$øèè=$œÔ›ùˆ->query("SHOW CREATE TABLE `{$˜‘©}`");$ù=$üØË{0x0f};®«µÎÂÅœ±ê½ÇÃÎ;$ù.= $üØË{0x0007};êà¼ÙëìŽÑ”ûÃÏ÷;$ù.= "-- Table structure for `{$˜‘©}`\n";Ú­§†;$ù.= $üØË{0x0007};Œ;Œ–¢;áÚôŸ´àÂ³¡¾Ãå»;$ù.= "DROP TABLE IF EXISTS `{$˜‘©}`;\n"; âì°Šó¨ÄõµµäÉ˜À¿¸ô Å¸Óç÷˜Í‡Ô”»;¨Ïƒ›±ŸÏàË†¯ËÌÀ¶ŠˆúÙ¡ Ô¿«àÖÍ¤Œ³ÍÜ¶èŽÖ¹î;$ù.= trim($øèè[0][$üØË[0x0000018]]).$üØË{0x019};if(!0x001===$this->write($ù)){return !0x001;}}$øèè=$œÔ›ùˆ->query("SELECT COUNT(*) AS count FROM `{$˜‘©}`");$‡=$øèè[$üØË[0x001a]][$üØË{0x0001b}];¤â¼£Îõ™ï»ÑÄ£ÊÜñÑ±†ŽÖ»­é¡×ñ°ÆîôêÒ…¨õÓžÄÚá‰ý¬åïþ˜öï²»;÷û½ÑžÞ¦ÞŠ‡µØ¬ÂŒùŸÃã®›ž¾Ý¾ñé«å¬£âêõ‚ÉœàÔ¤–®ÑÙºËùþ;Ì…Ù»úÅ€í…Ô;if($‡){if(0==$òò){$ù=$üØË{0x0007};$ù.= "-- Records of `{$˜‘©}`\n";$ù.= $üØË{0x0007};$this->write($ù);}$øèè=$œÔ›ùˆ->query("SELECT * FROM `{$˜‘©}` LIMIT {$òò}, 1000");foreach($øèè as $÷¢æ¥‰){$÷¢æ¥‰=array_map($üØË[0x00001c],$÷¢æ¥‰);Î²‘íëÕ‚¸Ú;²ÃÕ•®Ë—øè÷Í;¢„Õ‘ŠªžŸÄ‡˜æí½ïÅâ’••£–„ë‡ÉÇã¾†Ãó˜Íž¶íã½‡Ë¬Å»ò¨Îˆ¾òŸÃƒŒÊÌÓ®Œñµ;$ù="INSERT INTO `{$˜‘©}` VALUES ('".str_replace(array($üØË{0x000001d},$üØË{0x0f}),array($üØË[0x01e],$üØË{0x001f}),implode($üØË[0x00020],$÷¢æ¥‰)).$üØË{0x000021};Ÿ……ŽèÃ•´ðÛðã„¿ìÃ²‡µ™Òƒí‚ß·àÅ†ÊŒ³Ï¥èÀÙ¥†™’ÉËŸÑ‚;if(!0x001===$this->write($ù)){return !0x001;}}if($‡>$òò+0x03e8){return array($òò+0x03e8,$‡);}}return 0;}public function import($¦–){$Þ=&$_GET{¡};ù™ñ‰ÍÁ¯¶ƒ±‘¨·ª»‚öÚÓù”÷€¼Ÿ—Äý“ãŠ¬Õ”ù˜Ã±›õÂÃ®ìþ°äÚ…Þï;$ß¬öñ=\think\Db::connect();îŒ©²â¾à¯ÖÚ™Ï¨§ß¥‡ÉÝ³®”‘ºå½–é‡…ö±¸ÙïšŠÇô£—žÊ÷ÄÒÂ¢‡ð·™¬Ö»®ì¦¶òç¬÷ØÆ;if($this->config[$Þ{0x001}]){$€=gzopen($this->file[0x001],$Þ[0x0000022]);$±=0;}else{$±=filesize($this->file[0x001]);$€=fopen($this->file[0x001],$Þ[0x0000022]);}$¦¬íê=$Þ{0x023};if($¦–){$this->config[$Þ{0x001}]?gzseek($€,$¦–):fseek($€,$¦–);}for($Šà Î=0;$Šà Î<0x03e8;$Šà Î++){$¦¬íê.= $this->config[$Þ{0x001}]?gzgets($€):fgets($€);if(preg_match($Þ[0x0024],trim($¦¬íê))){if(!0x001!==$ß¬öñ->execute($¦¬íê)){$¦–+= strlen($¦¬íê);}else{return !0x001;}$¦¬íê=$Þ{0x023};}elseif($this->config[$Þ{0x001}]?gzeof($€):feof($€)){return 0;}}return array($¦–,$±);}public function __destruct(){}}